{
  "body_html": "<!doctype html><div class=\"lake-content-editor-core lake-engine lake-typography-classic\" data-lake-element=\"root\"><p style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 1.74; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">如果一旦执行`crontab -r`会清空当前用户下所有crontab配置命令。</p><p style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 1.74; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\"><br></p><h2 id=\"3W4md\" style=\"padding: 7px 0px; margin: 0px; font-weight: 700; font-size: 24px; line-height: 32px;\">复原方法</h2><p style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 1.74; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\"><br></p><p style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 1.74; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">这里只讲述不存在备份，用日志的方法恢复crontab的方法。</p><p style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 1.74; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\"><br></p><p style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 1.74; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">系统：Linux（其他系统做法类似）</p><p style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 1.74; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\"><br></p><h3 id=\"KlXhJ\" style=\"padding: 7px 0px; margin: 0px; font-weight: 700; font-size: 20px; line-height: 28px;\">确定要恢复的日志存在</h3><p style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 1.74; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\"><br></p><div data-card-type=\"block\" data-lake-card=\"codeblock\" id=\"SeAZn\"><div class=\"lake-codeblock-content\" style=\"border: 1px solid rgb(232, 232, 232); max-width: 750px; color: rgb(89, 89, 89); margin: 0px; padding: 0px; background: rgb(249, 249, 249);\"><div class=\"\" style=\"color: rgb(89, 89, 89); margin: 0px; padding: 16px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\"><pre class=\"cm-s-default\" style=\"color: rgb(89, 89, 89); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\"><span class=\"lake-preview-line\" style=\"color: rgb(89, 89, 89); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\"><span class=\"lake-preview-line-number lake-lm-pad-level-0\" style=\"color: rgb(191, 191, 191); margin: 0px 8px 0px 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\"></span><span class=\"lake-preview-codeblock-content\" style=\"color: rgb(89, 89, 89); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">ll /var/log/cron*</span></span></pre></div></div></div><p style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 1.74; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\"><br></p><p style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 1.74; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">【备注】这里的crontab日志是所有用户的日志</p><p style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 1.74; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\"><br></p><h3 id=\"yehfC\" style=\"padding: 7px 0px; margin: 0px; font-weight: 700; font-size: 20px; line-height: 28px;\">通过日志过滤需要的运行命令信息</h3><p class=\"lake-lineheight-25\" style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 2.5; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">我的Linux机器中crontab的日志信息主要如下：</p><p style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 1.74; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\"><br></p><div data-card-type=\"block\" data-lake-card=\"codeblock\" id=\"DMjHo\"><div class=\"lake-codeblock-content\" style=\"border: 1px solid rgb(232, 232, 232); max-width: 750px; color: rgb(89, 89, 89); margin: 0px; padding: 0px; background: rgb(249, 249, 249);\"><div class=\"\" style=\"color: rgb(89, 89, 89); margin: 0px; padding: 16px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\"><pre class=\"cm-s-default\" style=\"color: rgb(89, 89, 89); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\"><span class=\"lake-preview-line\" style=\"color: rgb(89, 89, 89); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\"><span class=\"lake-preview-line-number lake-lm-pad-level-0\" style=\"color: rgb(191, 191, 191); margin: 0px 8px 0px 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\"></span><span class=\"lake-preview-codeblock-content\" style=\"color: rgb(89, 89, 89); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">Oct <span class=\"cm-number\" style=\"color: rgb(0, 92, 197); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">9</span> <span class=\"cm-number\" style=\"color: rgb(0, 92, 197); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">03</span>:28:01 Stor-Test CROND[7987]: (root) CMD (/home/scripts/check_alive.sh)</span></span></pre></div></div></div><p style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 1.74; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\"><br></p><p class=\"lake-lineheight-25\" style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 2.5; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">我们现在的关键任务是将CMD后面的命令提出出来，并确定诶条命令的执行周期</p><p style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 1.74; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\"><br></p><h3 id=\"1v7vK\" style=\"padding: 7px 0px; margin: 0px; font-weight: 700; font-size: 20px; line-height: 28px;\">获取日志信息的命令</h3><p style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 1.74; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\"><br></p><div data-card-type=\"block\" data-lake-card=\"codeblock\" id=\"uiDT3\"><div class=\"lake-codeblock-content\" style=\"border: 1px solid rgb(232, 232, 232); max-width: 750px; color: rgb(89, 89, 89); margin: 0px; padding: 0px; background: rgb(249, 249, 249);\"><div class=\"\" style=\"color: rgb(89, 89, 89); margin: 0px; padding: 16px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\"><pre class=\"cm-s-default\" style=\"color: rgb(89, 89, 89); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\"><span class=\"lake-preview-line\" style=\"color: rgb(89, 89, 89); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\"><span class=\"lake-preview-line-number lake-lm-pad-level-0\" style=\"color: rgb(191, 191, 191); margin: 0px 8px 0px 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\"></span><span class=\"lake-preview-codeblock-content\" style=\"color: rgb(89, 89, 89); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\"><span class=\"cm-builtin\" style=\"color: rgb(111, 66, 193); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">cat</span> /var/log/cron | <span class=\"cm-builtin\" style=\"color: rgb(111, 66, 193); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">grep</span> <span class=\"cm-attribute\" style=\"color: rgb(111, 66, 193); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">-i</span> <span class=\"cm-string\" style=\"color: rgb(102, 153, 0); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">\"whoami\"</span> | <span class=\"cm-builtin\" style=\"color: rgb(111, 66, 193); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">grep</span> <span class=\"cm-string\" style=\"color: rgb(102, 153, 0); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">\"CMD\"</span> | <span class=\"cm-builtin\" style=\"color: rgb(111, 66, 193); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">awk</span> <span class=\"cm-attribute\" style=\"color: rgb(111, 66, 193); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">-F</span> <span class=\"cm-string\" style=\"color: rgb(102, 153, 0); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">'('</span> <span class=\"cm-string\" style=\"color: rgb(102, 153, 0); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">'{print $3}'</span> | <span class=\"cm-builtin\" style=\"color: rgb(111, 66, 193); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">awk</span> <span class=\"cm-attribute\" style=\"color: rgb(111, 66, 193); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">-F</span> <span class=\"cm-string\" style=\"color: rgb(102, 153, 0); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">')'</span> <span class=\"cm-string\" style=\"color: rgb(102, 153, 0); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">'{print $1}'</span> | <span class=\"cm-builtin\" style=\"color: rgb(111, 66, 193); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">sort</span> <span class=\"cm-attribute\" style=\"color: rgb(111, 66, 193); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">-u</span> &gt; cmd_tmp</span></span></pre></div></div></div><p class=\"lake-lineheight-25\" style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 2.5; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\"><br></p><p class=\"lake-lineheight-25\" style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 2.5; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">解释：</p><p class=\"lake-lineheight-25\" style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 2.5; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">grep -i \"whoami\" ：是为了过滤指定用户的信息，<span class=\"lake-fontsize-11\" style=\"color: rgb(38, 38, 38); font-size: 14px;\" data-mce-style=\"font-size: 11px\">whoami换成指定用户名称</span></p><p class=\"lake-lineheight-25\" style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 2.5; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">grep \"CMD\" ：是需要过滤命令行</p><p class=\"lake-lineheight-25\" style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 2.5; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">awk -F '(' '{print $3}'：是以'('为分隔符，提取第三个元素。这里结果为“/home/scripts/check_alive.sh)”</p><p class=\"lake-lineheight-25\" style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 2.5; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">awk -F ')' '{print $1}'：是以')'为分隔符，提取第一个元素。这里结果为“/home/scripts/check_alive.sh”</p><p class=\"lake-lineheight-25\" style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 2.5; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">这时，我们已经提取到自己所需要的命令了，但由于crontab定时触发，会有大量重复。后面需要进行去重</p><p class=\"lake-lineheight-25\" style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 2.5; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">sort -u &gt; cmd_tmp：去重后输出至cmd_tmp文件</p><p class=\"lake-lineheight-25\" style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 2.5; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">后续根据提取出来的命令再去 /var/log/cron文件中确认一下时间间隔，按照指定的执行频率恢复</p><p class=\"lake-lineheight-25\" style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 2.5; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">至此crontab恢复完毕</p><p class=\"lake-lineheight-25\" style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 2.5; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\"><br></p><h2 id=\"ABc1b\" style=\"padding: 7px 0px; margin: 0px; font-weight: 700; font-size: 24px; line-height: 32px;\">反思和总结</h2><p class=\"lake-lineheight-25\" style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 2.5; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">以后测试和发布内容之前一定要备份！！！为了防止类似事件再次发生，写一个自动化脚本是很有必要的。这里简单实现一个每天对crontab进行备份的脚本（备份最近7天的数据，每天定期删除7天前的数据）</p><p style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 1.74; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\"><br></p><div data-card-type=\"block\" data-lake-card=\"codeblock\" id=\"EOgJX\"><div class=\"lake-codeblock-content\" style=\"border: 1px solid rgb(232, 232, 232); max-width: 750px; color: rgb(89, 89, 89); margin: 0px; padding: 0px; background: rgb(249, 249, 249);\"><div class=\"\" style=\"color: rgb(89, 89, 89); margin: 0px; padding: 16px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\"><pre class=\"cm-s-default\" style=\"color: rgb(89, 89, 89); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\"><span class=\"lake-preview-line\" style=\"color: rgb(89, 89, 89); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\"><span class=\"lake-preview-line-number lake-lm-pad-level-0\" style=\"color: rgb(191, 191, 191); margin: 0px 8px 0px 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\"></span><span class=\"lake-preview-codeblock-content\" style=\"color: rgb(89, 89, 89); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\"><span class=\"cm-meta\" style=\"color: rgb(31, 127, 154); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">#!/bin/bash</span>\n</span></span><span class=\"lake-preview-line\" style=\"color: rgb(89, 89, 89); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\"><span class=\"lake-preview-line-number lake-lm-pad-level-0\" style=\"color: rgb(191, 191, 191); margin: 0px 8px 0px 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\"></span><span class=\"lake-preview-codeblock-content\" style=\"color: rgb(89, 89, 89); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\"><span class=\"cm-comment\" style=\"color: rgb(106, 115, 125); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\"># 每天对crontab 进行备份 ，同时删除7天前的数据</span>\n</span></span><span class=\"lake-preview-line\" style=\"color: rgb(89, 89, 89); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\"><span class=\"lake-preview-line-number lake-lm-pad-level-0\" style=\"color: rgb(191, 191, 191); margin: 0px 8px 0px 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\"></span><span class=\"lake-preview-codeblock-content\" style=\"color: rgb(89, 89, 89); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\"><span class=\"cm-def\" style=\"color: rgb(0, 92, 197); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">DATE</span><span class=\"cm-operator\" style=\"color: rgb(215, 58, 73); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">=</span><span class=\"cm-quote\" style=\"color: rgb(0, 153, 0); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">$(date +%Y%m%d)</span>\n</span></span><span class=\"lake-preview-line\" style=\"color: rgb(89, 89, 89); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\"><span class=\"lake-preview-line-number lake-lm-pad-level-0\" style=\"color: rgb(191, 191, 191); margin: 0px 8px 0px 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\"></span><span class=\"lake-preview-codeblock-content\" style=\"color: rgb(89, 89, 89); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">crontab <span class=\"cm-attribute\" style=\"color: rgb(111, 66, 193); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">-l</span> &gt; /home/work/bak/crontab_<span class=\"cm-def\" style=\"color: rgb(0, 92, 197); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">$DATE</span>.bak\n</span></span><span class=\"lake-preview-line\" style=\"color: rgb(89, 89, 89); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\"><span class=\"lake-preview-line-number lake-lm-pad-level-0\" style=\"color: rgb(191, 191, 191); margin: 0px 8px 0px 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\"></span><span class=\"lake-preview-codeblock-content\" style=\"color: rgb(89, 89, 89); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\"><span class=\"cm-builtin\" style=\"color: rgb(111, 66, 193); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">find</span> /home/work/bak/ <span class=\"cm-attribute\" style=\"color: rgb(111, 66, 193); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">-mtime</span> <span class=\"cm-operator\" style=\"color: rgb(215, 58, 73); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">+</span><span class=\"cm-number\" style=\"color: rgb(0, 92, 197); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">7</span> <span class=\"cm-attribute\" style=\"color: rgb(111, 66, 193); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">-name</span> <span class=\"cm-string\" style=\"color: rgb(102, 153, 0); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">'*.bak'</span> <span class=\"cm-attribute\" style=\"color: rgb(111, 66, 193); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">-exec</span> <span class=\"cm-builtin\" style=\"color: rgb(111, 66, 193); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">rm</span> <span class=\"cm-attribute\" style=\"color: rgb(111, 66, 193); margin: 0px; padding: 0px; background: none 0% 0% / auto repeat scroll padding-box border-box rgba(0, 0, 0, 0);\">-rf</span> {} ;</span></span></pre></div></div></div><p class=\"lake-lineheight-25\" style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 2.5; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\"><br></p><h3 id=\"G9iW0\" style=\"padding: 7px 0px; margin: 0px; font-weight: 700; font-size: 20px; line-height: 28px;\">复原原理</h3><p class=\"lake-lineheight-25\" style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 2.5; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">没有备份文件，crontab的复原方法</p><p class=\"lake-lineheight-25\" style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 2.5; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">我们要恢复crontab，恢复的文件是哪个？</p><p class=\"lake-lineheight-25\" style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 2.5; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">Linux下会根据用户的登录名，在/var/spool/cron下生成对应的文件。平时我们执行的crontab -e操作的文件时，编辑的文件就是/var/spool/cron/user_name</p><p class=\"lake-lineheight-25\" style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 2.5; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">例如：root用户操作的是/var/spool/cron/root，其他用户同理</p><p class=\"lake-lineheight-25\" style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 2.5; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">crontab的日志保存在哪里？</p><p class=\"lake-lineheight-25\" style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 2.5; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">保存在/var/log/下</p><p class=\"lake-lineheight-25\" style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 2.5; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">为什么/var/log/cron文件可以恢复crontab？</p><p class=\"lake-lineheight-25\" style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 2.5; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">这里的/var/log/cron文件其实是crontab的日志，crontab执行的每个人物的时间、命令等详细信息都记录在这里，所以可以用这里的信息进行恢复。</p><p style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 1.74; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\"><br></p><h2 id=\"tsYJe\" style=\"padding: 7px 0px; margin: 0px; font-weight: 700; font-size: 24px; line-height: 32px;\">其他方案</h2><p style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 1.74; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">对于crontab其他比较安全的策略：</p><p style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 1.74; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\">1、将<span class=\"lake-fontsize-11\" style=\"color: rgb(38, 38, 38); font-size: 14px;\" data-mce-style=\"font-size: 11px\">/var/spool/cron/user_name文件添加到git定期缓存到本地。</span></p><p style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 1.74; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\"><span class=\"lake-fontsize-11\" style=\"color: rgb(38, 38, 38); font-size: 14px;\" data-mce-style=\"font-size: 11px\">2、使用第三方web调度管理系统，在web网页上操作，加入审核防止出错。</span></p><p style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 1.74; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\"><span class=\"lake-fontsize-11\" style=\"color: rgb(38, 38, 38); font-size: 14px;\" data-mce-style=\"font-size: 11px\">3、像php框架laravel一样将脚本执行频次放到一个入口代码中，相当于给所有要执行的crontab任务增加一个汇总入口页，crontab中只需要配置这个入口页脚本即可。代码用版本管理工具管理，不容易误删除。</span></p><p style=\"font-size: 15px; color: rgb(64, 64, 64); line-height: 1.74; letter-spacing: 0.008em; outline-style: none; overflow-wrap: break-word; margin: 0px;\"><br></p></div>",
  "slug": 6390468,
  "title": "crontab -r 清除后找回"
}