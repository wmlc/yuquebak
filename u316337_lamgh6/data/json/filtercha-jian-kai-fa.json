{
  "body_html": "<div><head></head><body>filter&#x63D2;&#x4EF6;&#x5F00;&#x53D1;\n    \n    \n    \n    \n    \n  <link href=\"https://www.yuque.com/attachments/yuque/0/2020/css/491128/1588213910235-976bcd3a-7a9c-473d-b800-1b1df54807d4.css\" rel=\"stylesheet\" type=\"text/css\">\n<link href=\"https://www.yuque.com/attachments/yuque/0/2020/css/491128/1588213910286-64db0dd0-ac29-46fb-9241-76ef318b1b53.css\" rel=\"stylesheet\" type=\"text/css\">\n\n  \n        \n<div class=\"page\">\n    \n        <h1 class=\"book-chapter\" id=\"calibre_toc_26\">filter&#x63D2;&#x4EF6;&#x5F00;&#x53D1;</h1>\n        <div class=\"section\">\n            <h2 id=\"&#x4FEE;&#x6539;1&#x3001;&#x751F;&#x6210;filter&#x63D2;&#x4EF6;&#x5DE5;&#x7A0B;\" class=\"calibre13\">&#x4FEE;&#x6539;1&#x3001;&#x751F;&#x6210;filter&#x63D2;&#x4EF6;&#x5DE5;&#x7A0B;</h2>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">[root@bogon logstash_plugin]# /opt/logstash/bin/logstash-plugin generate --type filter --name lynis  --path /opt/l\nogstash_plugin\n Creating /opt/logstash_plugin/logstash-filter-lynis\n     create logstash-filter-lynis/CHANGELOG.md\n     create logstash-filter-lynis/CONTRIBUTORS\n     create logstash-filter-lynis/DEVELOPER.md\n     create logstash-filter-lynis/Gemfile\n     create logstash-filter-lynis/LICENSE\n     create logstash-filter-lynis/README.md\n     create logstash-filter-lynis/Rakefile\n     create logstash-filter-lynis/lib/logstash/filters/lynis.rb\n     create logstash-filter-lynis/logstash-filter-lynis.gemspec\n     create logstash-filter-lynis/spec/filters/lynis_spec.rb\n     create logstash-filter-lynis/spec/spec_helper.rb\n[root@bogon logstash_plugin]# ll\ntotal 8\ndrwxr-xr-x. 4 root root 4096 9&#x6708;  26 10:48 logstash-filter-lynis\ndrwxr-xr-x. 4 root root 4096 9&#x6708;  26 10:47 logstash-filter-test\n[root@bogon logstash_plugin]#\n</code></pre><h2 id=\"2&#x3001;&#x4FEE;&#x6539;&#x4EE3;&#x7801;\" class=\"calibre13\">2&#x3001;&#x4FEE;&#x6539;&#x4EE3;&#x7801;</h2>\n<p class=\"calibre12\">&#x6587;&#x4EF6;&#xFF1A;/opt/logstash_plugin/logstash-filter-lynis/lib/logstash/filters/lynis.rb</p>\n<ul class=\"calibre17\">\n<li class=\"calibre18\">&#x589E;&#x52A0;&#x7C7B;&#x6210;&#x5458;&#x53D8;&#x91CF;source&#xFF1A;</li>\n</ul>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">class LogStash::Filters::Lynis &lt; LogStash::Filters::Base\n\n  # Setting the config_name here is required. This is how you\n  # configure this filter from your Logstash config.\n  #\n  # filter {\n  #    {\n  #     message =&gt; &quot;My message...&quot;\n  #   }\n  # }\n  #\n  config_name &quot;lynis&quot;\n\n  # Replace the message with this value.\n  #config :message, :validate =&gt; :string, :default =&gt; &quot;Hello World!&quot;\n  config :source, :validate =&gt; :string, :default =&gt; &quot;message&quot;\n</code></pre><ul class=\"calibre17\">\n<li class=\"calibre18\">&#x4FEE;&#x6539;filter&#x51FD;&#x6570;&#xFF1A;</li>\n</ul>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">  public\n  def filter(event)\n    source_value = event.get(@source)\n    index = source_value.index(&quot;=&quot;)                                                              \n    source_len = source_value.length                                                             \n\n    if index!=nil &amp;&amp; index!=0                                                                    \n        dest_key = source_value[0, index]                                                        \n        dest_value = source_value[index+1, source_len]                                           \n\n        event.set(dest_key, dest_value)                                                          \n    end\n    # filter_matched should go in the last line of our successful code                           \n    filter_matched(event)\n end\n</code></pre><h2 id=\"3&#x3001;&#x4FEE;&#x6539;&#x914D;&#x7F6E;&#x4FE1;&#x606F;\" class=\"calibre13\">3&#x3001;&#x4FEE;&#x6539;&#x914D;&#x7F6E;&#x4FE1;&#x606F;</h2>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">root@bogon logstash-filter-lynis]# cat logstash-filter-lynis.gemspec \nGem::Specification.new do |s|\n  s.name          = &apos;logstash-filter-lynis&apos;\n  s.version       = &apos;1.1.0&apos;\n  s.licenses      = [&apos;Apache License (2.0)&apos;]\n  s.summary       = &apos;this plugin is used process lynis report data&apos;\n  s.description   = &apos;Write a longer description or delete this line.&apos;\n  s.homepage      = &apos;https://github.com/anbc&apos;\n  s.authors       = [&apos;anbc&apos;]\n  s.email         = &apos;anbingchun@163.com&apos;\n  s.require_paths = [&apos;lib&apos;]\n\n  # Files\n  s.files = Dir[&apos;lib/**/*&apos;,&apos;spec/**/*&apos;,&apos;vendor/**/*&apos;,&apos;*.gemspec&apos;,&apos;*.md&apos;,&apos;CONTRIBUTORS&apos;,&apos;Gemfile&apos;,&apos;LICENSE&apos;,&apos;NOTICE.TXT&apos;]\n   # Tests\n  s.test_files = s.files.grep(%r{^(test|spec|features)/})\n\n  # Special flag to let us know this is actually a logstash plugin\n  s.metadata = { &quot;logstash_plugin&quot; =&gt; &quot;true&quot;, &quot;logstash_group&quot; =&gt; &quot;filter&quot; }\n\n  # Gem dependencies\n  s.add_runtime_dependency &quot;logstash-core-plugin-api&quot;, &quot;~&gt; 2.0&quot;\n  s.add_development_dependency &apos;logstash-devutils&apos;\nend\n</code></pre><h2 id=\"4&#x3001;&#x5B89;&#x88C5;logstash-plugin&#x9700;&#x8981;&#x7684;&#x4F9D;&#x8D56;\" class=\"calibre13\">4&#x3001;&#x5B89;&#x88C5;Logstash plugin&#x9700;&#x8981;&#x7684;&#x4F9D;&#x8D56;</h2>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">bundle install\n</code></pre><h2 id=\"5&#x3001;&#x4F7F;&#x7528;spec&#x8FDB;&#x884C;&#x5355;&#x5143;&#x6D4B;&#x8BD5;\" class=\"calibre13\">5&#x3001;&#x4F7F;&#x7528;spec&#x8FDB;&#x884C;&#x5355;&#x5143;&#x6D4B;&#x8BD5;</h2>\n<p class=\"calibre12\">&#x901A;&#x8FC7;&#x7F16;&#x5199;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;&#x5B8C;&#x6210;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x5DE5;&#x4F5C;&#xFF0C;&#x5177;&#x4F53;&#x5355;&#x5143;&#x6D4B;&#x8BD5;&#x4EE3;&#x7801;&#x4F4D;&#x4E8E;</p>\n<p class=\"calibre12\"><code class=\"pcalibre5 pcalibre6 calibre19\">/opt/logstash_plugin/logstash-filter-lynis/spec/filters/lynis_spec.rb</code></p>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\"># encoding: utf-8\nrequire_relative &apos;../spec_helper&apos;\nrequire &quot;logstash/filters/lynis&quot;\n\ndescribe LogStash::Filters::Lynis do\n  describe &quot;Set to Hello World&quot; do\n  #&#x8BBE;&#x7F6E;logstash&#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;\n    let(:config) do &lt;&lt;-CONFIG\n      filter { #&#x5177;&#x4F53;&#x7684;filter\n        lynis {  #filter&#x63D2;&#x4EF6;&#x7684;&#x540D;&#x79F0;\n          source =&gt; &quot;message&quot;  #&#x5C06;message&#x5B57;&#x6BB5;&#x7684;&#x4FE1;&#x606F;&#x4F20;&#x5165;source&#x4E2D;\n        }\n      }\n    CONFIG\n    end\n\n    #&#x4F20;&#x5165;&#x4E00;&#x6761;&#x8F93;&#x5165;&#x6570;&#x636E;\n    sample(&quot;message&quot; =&gt; &quot;hello=world&quot;) do #&#x8F93;&#x5165;&#x6570;&#x636E;&#x7684;key&#x662F;message&#xFF0C;value&#x662F;hello=world&#x3002;\n    #sample(&quot;hello=world&quot;) do  #&#x5FFD;&#x7565;key&#x7684;&#x8868;&#x8FBE;&#x65B9;&#x5F0F;\n      expect(subject).to include(&quot;hello&quot;) #&#x5224;&#x65AD;&#x89E3;&#x6790;&#x540E;&#x7684;output&#x6570;&#x636E;&#x4E2D;&#xFF0C;&#x662F;&#x5426;&#x5305;&#x542B;key&#x4E3A;hello&#x7684;&#x6570;&#x636E;\n      expect(subject.get(&apos;hello&apos;)).to eq(&apos;world&apos;)#&#x5224;&#x65AD;&#x4EE5;hello&#x4E3A;key&#x7684;&#x6570;&#x636E;&#x7684;&#x503C;&#x662F;&#x5426;&#x662F;world\n    end  \n  end   \nend\n</code></pre><h2 id class=\"calibre13\"> </h2>\n<h2 id=\"5&#x3001;&#x6D4B;&#x8BD5;&#x63D2;&#x4EF6;\" class=\"calibre8\">5&#x3001;&#x6D4B;&#x8BD5;&#x63D2;&#x4EF6;</h2>\n<p class=\"calibre12\">&#x8FD0;&#x884C;&#x547D;&#x4EE4;&#xFF1A;</p>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">bundle exec rspec\n</code></pre><p class=\"calibre12\">&#x8FD0;&#x884C;&#x7ED3;&#x679C;&#xFF1A;</p>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">[root@bogon logstash-filter-lynis]# bundle exec rspec\n--- jar coordinate com.fasterxml.jackson.core:jackson-databind already loaded with version 2.7.4 - omit version 2.9.1\n--- jar coordinate com.fasterxml.jackson.core:jackson-annotations already loaded with version 2.7.0 - omit version 2.9.1\n--- jar coordinate com.fasterxml.jackson.module:jackson-module-afterburner already loaded with version 2.7.4 - omit version 2.9.1\n--- jar coordinate com.fasterxml.jackson.core:jackson-core already loaded with version 2.7.4 - omit version 2.9.1\nERROR StatusLogger No log4j2 configuration file found. Using default configuration: logging only errors to the console.\nSending Logstash&apos;s logs to  which is now configured via log4j2.properties\nRun options: exclude {:redis=&gt;true, :socket=&gt;true, :performance=&gt;true, :couchdb=&gt;true, :elasticsearch=&gt;true, :elasticsearch_secure=&gt;true, :export_cypher=&gt;true, :integration=&gt;true, :windows=&gt;true}\n\nRandomized with seed 32702\n.\n\nFinished in 0.42843 seconds (files took 8.8 seconds to load)\n1 example, 0 failures\n\nRandomized with seed 32702\n</code></pre><h2 id=\"6&#x3001;&#x751F;&#x6210;gem&#x5305;\" class=\"calibre13\">6&#x3001;&#x751F;&#x6210;gem&#x5305;</h2>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">[root@bogon logstash-filter-lynis]# gem build logstash-filter-lynis.gemspec \n  Successfully built RubyGem\n  Name: logstash-filter-lynis\n  Version: 1.1.0\n  File: logstash-filter-lynis-1.1.0.gem\n[root@bogon logstash-filter-lynis]# ll\ntotal 44\n-rw-r--r--. 1 root root   63 9&#x6708;  26 10:48 CHANGELOG.md\n-rw-r--r--. 1 root root  407 9&#x6708;  26 10:48 CONTRIBUTORS\n-rw-r--r--. 1 root root  119 9&#x6708;  26 10:48 DEVELOPER.md\n-rw-r--r--. 1 root root   39 9&#x6708;  26 10:48 Gemfile\n-rw-r--r--. 1 root root 3043 9&#x6708;  26 11:13 Gemfile.lock\ndrwxr-xr-x. 3 root root   21 9&#x6708;  26 10:48 lib\n-rw-r--r--. 1 root root  524 9&#x6708;  26 10:48 LICENSE\n-rw-r--r--. 1 root root 7680 9&#x6708;  26 16:49 logstash-filter-lynis-1.1.0.gem\n-rw-r--r--. 1 root root  916 9&#x6708;  26 11:12 logstash-filter-lynis.gemspec\n-rw-r--r--. 1 root root   33 9&#x6708;  26 10:48 Rakefile\n-rw-r--r--. 1 root root 3032 9&#x6708;  26 10:48 README.md\ndrwxr-xr-x. 3 root root   41 9&#x6708;  26 14:04 spec\n[root@bogon logstash-filter-lynis]#\n</code></pre><h2 id=\"7&#x3001;&#x5B89;&#x88C5;&#x63D2;&#x4EF6;\" class=\"calibre13\">7&#x3001;&#x5B89;&#x88C5;&#x63D2;&#x4EF6;</h2>\n<ul class=\"calibre17\">\n<li class=\"calibre18\">&#x624B;&#x52A8;&#x5B89;&#x88C5;logstash</li>\n</ul>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">[root@bogon opt]# tar -xvf logstash-5.6.1.tar.gz\n[root@bogon opt]# ln -s logstash-5.6.1.tar.gz  logstatsh\n</code></pre><ul class=\"calibre17\">\n<li class=\"calibre18\">&#x67E5;&#x770B;&#x5F53;&#x524D;&#x63D2;&#x4EF6;</li>\n</ul>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">[root@bogon logstash-5.6.1]# ./bin/logstash-plugin list\nlogstash-codec-cef\nlogstash-codec-collectd\nlogstash-codec-dots\nlogstash-codec-edn\nlogstash-codec-edn_lines\nlogstash-codec-es_bulk\nlogstash-codec-fluent\nlogstash-codec-graphite\nlogstash-codec-json\n</code></pre><ul class=\"calibre17\">\n<li class=\"calibre18\">&#x5B89;&#x88C5;&#x63D2;&#x4EF6;</li>\n</ul>\n<p class=\"calibre12\">&#x7531;&#x4E8E;gem&#x6587;&#x4EF6;&#x8DEF;&#x5F84;&#x9519;&#x8BEF;&#xFF0C;&#x5BFC;&#x81F4;&#x7684;&#x9519;&#x8BEF;&#x63D0;&#x793A;</p>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">[root@bogon logstash-5.6.1]# /opt/logstash/bin/logstash-plugin install /opt/logstash_plugin/logtash-\nfilter-lynis/ogstash-filter-lynis-1.1.0.gem\nValidating /opt/logstash_plugin/logtash-filter-lynis/ogstash-filter-lynis-1.1.0.gem\nPlugin /opt/logstash_plugin/logtash-filter-lynis/ogstash-filter-lynis-1.1.0.gem does not exist\nERROR: Installation aborted, verification failed for /opt/logstash_plugin/logtash-filter-lynis/ogstash-filter-lynis-1.1.0.gem\n[root@bogon logstash-5.6.1]#\n</code></pre><p class=\"calibre12\">&#x5B89;&#x88C5;&#x6210;&#x529F;</p>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">[root@bogon logstash-filter-lynis]# /opt/logstash/bin/logstash-plugin install /opt/logstash_plugin/l\nogstash-filter-lynis/logstash-filter-lynis-1.1.0.gem\nValidating /opt/logstash_plugin/logstash-filter-lynis/logstash-filter-lynis-1.1.0.gem\nInstalling logstash-filter-lynis\n</code></pre><p class=\"calibre12\">&#x6267;&#x884C;&#x4E0A;&#x9762;&#x547D;&#x4EE4;&#x65F6;&#xFF0C;&#x4F1A;&#x51FA;&#x73B0;&#x5361;&#x6B7B;&#x73B0;&#x8C61;&#xFF0C;ctrl+c &#x7EC8;&#x6B62;&#x540E;&#xFF0C;&#x5B89;&#x88C5;&#x6B63;&#x5E38;&#x3002;</p>\n<ul class=\"calibre17\">\n<li class=\"calibre18\">&#x9A8C;&#x8BC1;&#x662F;&#x5426;&#x5B89;&#x88C5;&#x6210;&#x529F;</li>\n</ul>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">[root@bogon local_gems]# /opt/logstash/bin/logstash-plugin list\n........\nlogstash-codec-netflow\nlogstash-codec-plain\nlogstash-codec-rubydebug\n...............\nlogstash-filter-fingerprint\nlogstash-filter-geoip\nlogstash-filter-grok\nlogstash-filter-json\nlogstash-filter-kv\nlogstash-filter-lynis  #&#x65B0;&#x5B89;&#x88C5;&#x7684;lynis&#x63D2;&#x4EF6;\nlogstash-filter-metrics\n..............\nlogstash-input-beats\nlogstash-input-couchdb_changes\nlogstash-input-dead_letter_q\n</code></pre><h2 id=\"8&#x3001;&#x4FEE;&#x6539;logstash&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x8C03;&#x7528;&#x6307;&#x5B9A;&#x63D2;&#x4EF6;\" class=\"calibre13\">8&#x3001;&#x4FEE;&#x6539;logstash&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x8C03;&#x7528;&#x6307;&#x5B9A;&#x63D2;&#x4EF6;</h2>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">[root@bogon config]# vim logstash.conf\n\n\ninput\n{\n    stdin{}\n\n}\n\n\nfilter\n{\n    lynis  \n    {\n        source =&gt; &quot;message&quot;\n        add_tag =&gt; [&quot;lynis_data&quot;]\n        #remove_field =&gt; [&quot;message&quot;]\n\n    }\n\n}\n\noutput\n{\n    stdout { codec =&gt; rubydebug }\n\n}\n</code></pre><h2 id=\"9&#x3001;&#x6D4B;&#x8BD5;&#x63D2;&#x4EF6;&#x6548;&#x679C;\" class=\"calibre13\">9&#x3001;&#x6D4B;&#x8BD5;&#x63D2;&#x4EF6;&#x6548;&#x679C;</h2>\n<ul class=\"calibre17\">\n<li class=\"calibre18\">&#x8FD0;&#x884C;logstash</li>\n</ul>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">[root@bogon config]# /opt/logstash/bin/logstash -f /opt/logstash/config/logstash.conf \n2017-09-26 18:05:45,183 main ERROR Unable to locate appender &quot;${sys:ls.log.format}_console&quot; for logger config &quot;root&quot;\n2017-09-26 18:05:45,184 main ERROR Unable to locate appender &quot;${sys:ls.log.format}_rolling&quot; for logger config &quot;root&quot;\n2017-09-\n</code></pre><ul class=\"calibre17\">\n<li class=\"calibre18\">&#x6570;&#x636E;&#x89E3;&#x6790;&#x60C5;&#x51B5;</li>\n</ul>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">#&#x952E;&#x76D8;&#x8F93;&#x5165;&#x5185;&#x5BB9;\nhello=world  \n#&#x6570;&#x636E;&#x89E3;&#x6790;\n{\n      &quot;@version&quot; =&gt; &quot;1&quot;,\n          &quot;host&quot; =&gt; &quot;0.0.0.0&quot;,\n    &quot;@timestamp&quot; =&gt; 2017-09-26T10:06:02.741Z,\n         &quot;hello&quot; =&gt; &quot;world&quot;,\n       &quot;message&quot; =&gt; &quot;hello=world&quot;,\n          &quot;tags&quot; =&gt; [\n        [0] &quot;lynis_data&quot;\n    ]\n}\n\n#&#x952E;&#x76D8;&#x8F93;&#x5165;&#x5185;&#x5BB9;\ndddd \n#&#x6570;&#x636E;&#x89E3;&#x6790;\n{\n      &quot;@version&quot; =&gt; &quot;1&quot;,\n          &quot;host&quot; =&gt; &quot;0.0.0.0&quot;,\n    &quot;@timestamp&quot; =&gt; 2017-09-26T10:06:06.321Z,\n       &quot;message&quot; =&gt; &quot;dddd&quot;,\n          &quot;tags&quot; =&gt; [\n        [0] &quot;lynis_data&quot;\n    ]\n}\n\n#&#x952E;&#x76D8;&#x8F93;&#x5165;&#x5185;&#x5BB9;\nos=linux=   \n#&#x6570;&#x636E;&#x89E3;&#x6790;\n{\n      &quot;@version&quot; =&gt; &quot;1&quot;,\n          &quot;host&quot; =&gt; &quot;0.0.0.0&quot;,\n    &quot;@timestamp&quot; =&gt; 2017-09-26T10:06:20.110Z,\n       &quot;message&quot; =&gt; &quot;os=linux=&quot;,\n            &quot;os&quot; =&gt; &quot;linux=&quot;,\n          &quot;tags&quot; =&gt; [\n        [0] &quot;lynis_data&quot;\n    ]\n}\n\n#&#x952E;&#x76D8;&#x6570;&#x636E;&#x5185;&#x5BB9;\nddd=dd==dd\n#&#x6570;&#x636E;&#x89E3;&#x6790;\n{\n      &quot;@version&quot; =&gt; &quot;1&quot;,\n          &quot;host&quot; =&gt; &quot;0.0.0.0&quot;,\n    &quot;@timestamp&quot; =&gt; 2017-09-26T10:06:30.725Z,\n       &quot;message&quot; =&gt; &quot;ddd=dd==dd&quot;,\n           &quot;ddd&quot; =&gt; &quot;dd==dd&quot;,\n          &quot;tags&quot; =&gt; [\n        [0] &quot;lynis_data&quot;\n    ]\n}\n</code></pre>\n        </div>\n    \n</div>\n\n        \n    \n\n\n\n</body></div>",
  "slug": 6588890,
  "title": "filtercha-jian-kai-fa"
}