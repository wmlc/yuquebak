{
  "body_html": "\n\n  \n    将collectd作为input输入\n    \n    \n    \n    \n    \n  <link href=\"https://www.yuque.com/attachments/yuque/0/2020/css/491128/1588213910235-976bcd3a-7a9c-473d-b800-1b1df54807d4.css\" rel=\"stylesheet\" type=\"text/css\" />\n<link href=\"https://www.yuque.com/attachments/yuque/0/2020/css/491128/1588213910286-64db0dd0-ac29-46fb-9241-76ef318b1b53.css\" rel=\"stylesheet\" type=\"text/css\" />\n\n  \n        \n<div class=\"page\">\n    \n        <h1 class=\"book-chapter\" id=\"calibre_toc_14\">将collectd作为input输入</h1>\n        <div class=\"section\">\n            <h1 id=\"将collectd作为input输入\" class=\"calibre7\">将collectd作为input输入</h1>\n<h2 id=\"1、yum安装collectd\" class=\"calibre8\">1、yum安装collectd</h2>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">sudo yum -y install collectd\n</code></pre><h2 id=\"2、手动源码安装collectd\" class=\"calibre13\">2、手动源码安装collectd</h2>\n<h3 id=\"安装collectd依赖的软件包\" class=\"calibre9\">安装collectd依赖的软件包</h3>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">rpm -ivh \"http://dl.fedoraproject.org/pub/epel/6/i386/epel-release-6-8.noarch.rpm\"\nyum -y install libcurl libcurl-devel rrdtool rrdtool-devel perl-rrdtool rrdtool-prel libgcrypt-devel gcc make gcc-c++ liboping liboping-devel perl-CPAN net-snmp net-snmp-devel\n</code></pre><p class=\"calibre12\"><strong class=\"calibre16\">(1)、安装epel</strong></p>\n<p class=\"calibre12\">epel是（Extra Packages for Enterprise Linux ）【企业版 Linux 附加软件包(以下简称 EPEL)】是一个由特别兴趣小组创建、维护并管理的，针对 红帽企业版 Linux(RHEL)及其衍生发行版(比如 CentOS、 Scientific Linux)的一个高质量附加软件包项目。 </p>\n<p class=\"calibre12\"><strong class=\"calibre16\">（2）、安装相关的依赖库</strong></p>\n<ul class=\"calibre17\">\n<li class=\"calibre18\"><p class=\"calibre12\">libcurl:\n  是一个关于http，ftp等协议的开源库，通过该库你能够模拟出这些协议的过程；可在 <a href=\"http:_curl.haxx.se_download\" target=\"_blank\" class=\"pcalibre pcalibre2 pcalibre1 calibre20\">http://curl.haxx.se/download.html</a> 下载符合你要求的平台；</p>\n</li>\n<li class=\"calibre18\"><p class=\"calibre12\">libcurl-devel:</p>\n</li>\n<li class=\"calibre18\"><p class=\"calibre12\">rrdtool: \n  RRDtool是指Round Robin Database 工具（环状数据库）。Round robin是一种处理定量数据、以及当前元素指针的技术。想象一个周边标有点的圆环－－这些点就是时间存储的位置。从圆心画一条到圆周的某个点的箭头－－这就是指针。就像我们在一个圆环上一样，没有起点和终点，你可以一直往下走下去。过来一段时间，所有可用的位置都会被用过，该循环过程会自动重用原来的位置。这样，数据集不会增大，并且不需要维护。RRDtool处理RRD数据库。它用向RRD数据库存储数据、从RRD数据库中提取数据。</p>\n</li>\n<li class=\"calibre18\"><p class=\"calibre12\">rrdtool-devel:</p>\n</li>\n<li class=\"calibre18\"><p class=\"calibre12\">perl-rrdtool:</p>\n</li>\n<li class=\"calibre18\"><p class=\"calibre12\">rrdtool-prel：找不到该包</p>\n</li>\n<li class=\"calibre18\"><p class=\"calibre12\">libgcrypt:\nlibgcrypt使用一些不透明的变长数据结构表示相关的抽象数据类型(或者说对象),它们对于调用libgcrypt接口函数的调用者是不透明的,libgcrypt会填写相关的结构,高层的API调用会进入到内部结构中的函数指针指向的函数,所以也可以将libgcrypt理解为面向对象的设计使用结构化编程实现,这与NT内核的编程风格一致.</p>\n</li>\n<li class=\"calibre18\"><p class=\"calibre12\">libgcrypt-devel： </p>\n</li>\n<li class=\"calibre18\"><p class=\"calibre12\">gcc:</p>\n</li>\n<li class=\"calibre18\"><p class=\"calibre12\">make: </p>\n</li>\n<li class=\"calibre18\"><p class=\"calibre12\">gcc-c++: </p>\n</li>\n<li class=\"calibre18\"><p class=\"calibre12\">liboping: </p>\n<p class=\"calibre12\">是一个C库通过使用ICMP回应请求来衡量网络延迟。它可以并行的从多个主机发送和接收数据包，非常适合来做监控程序。 透明的支持IPv4和IPv6。</p>\n</li>\n<li class=\"calibre18\"><p class=\"calibre12\">liboping-devel:</p>\n</li>\n<li class=\"calibre18\"><p class=\"calibre12\">perl-CPAN: </p>\n</li>\n<li class=\"calibre18\"><p class=\"calibre12\">net-snmp: </p>\n<p class=\"calibre12\">Net-SNMP是一个免费的、开放源码的SNMP实现，以前称为UCD-SNMP。它包括agent和多个管理工具的源代码，支持多种扩展方式。\n简单网络管理协议（SNMP）</p>\n</li>\n<li class=\"calibre18\"><p class=\"calibre12\">net-snmp-devel:</p>\n</li>\n</ul>\n<h3 id=\"源码安装collectd\" class=\"calibre9\">源码安装collectd</h3>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">wget https://collectd.org/files/collectd-5.5.0.tar.gz\ntar zxvf collectd-5.5.0.tar.gz\ncd collectd-5.5.0\n./configure --prefix=/usr --sysconfdir=/etc --localstatedir=/var --libdir=/usr/lib --mandir=/usr/share/man --enable-all-plugins\nmake &amp;&amp; make install\n</code></pre><p class=\"calibre12\">注：如图所示 configure 是一个可执行的Perl脚本\n<img alt src=\"https://cdn.nlark.com/yuque/0/2020/png/491128/1588213912973-0900ecce-181c-488c-a92a-7609a0616769.png\" class=\"calibre14\" /></p>\n<h3 id=\"安装启动脚本\" class=\"calibre9\">安装启动脚本</h3>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">cp contrib/redhat/init.d-collectd /etc/init.d/collectd\nchmod +x /etc/init.d/collectd\n</code></pre><h3 id=\"启动collectd\" class=\"calibre9\">启动collectd</h3>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">service collectd start\n</code></pre><h2 id=\"3、手动安装2\" class=\"calibre13\">3、手动安装2</h2>\n<h3 id=\"31、安装perl\" class=\"calibre9\">3.1、安装perl</h3>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">yum install perl*\nyum install cpan\n</code></pre><p class=\"calibre12\">不安装perl的话，安装会遇到错误</p>\n<h3 id=\"32、安装collectd\" class=\"calibre9\">3.2、安装collectd</h3>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">wget https://collectd.org/files/collectd-5.5.2.tar.gz\ntar zxvf collectd-5.5.2.tar.gz\ncd collectd-5.5.2\n./configure \nmake \nmake install\n</code></pre><p class=\"calibre12\">通过上边几条命令实现：下载collectd源码、进行解压缩、配置、make编译、安装</p>\n<h3 id=\"33、配置collectd服务脚本\" class=\"calibre9\">3.3、配置collectd服务脚本</h3>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">cp contrib/redhat/init.d-collectd /etc/init.d/collectd\nchmod +x /etc/init.d/collectd\n</code></pre><p class=\"calibre12\">需要对原有的启动脚本进行修改，修改后的脚本内容需要</p>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">[root@t0-security-tdas02 init.d]# cat collectd\n#!/bin/bash\n#\n# collectd    Startup script for the Collectd statistics gathering daemon\n# chkconfig: - 99 01\n# description: Collectd is a statistics gathering daemon used to collect \\\n#   system information ie. cpu, memory, disk, network\n# processname: collectd\n# config: /etc/collectd.conf\n# config: /etc/sysconfig/collectd\n# pidfile: /var/run/collectd.pid\n\n# Source function library.\n. /etc/init.d/functions\n\nRETVAL=0\nARGS=\"\"\n#prog=\"collectdmon\" #原有值\nprog=\"/opt/collectd/sbin/collectdmon\"\nservice=\"collectd\"\n#CONFIG=/etc/collectd.conf #原有值\nCONFIG=/opt/collectd/etc/collectd.conf\n#COLLECTD=/usr/sbin/collectd  #原有值\nCOLLECTD=/opt/collectd/sbin/collectd\nCOLLECTDMONPIDDIR=\"/var/run\"\nCOLLECTDMONPID=\"$COLLECTDMONPIDDIR/collectdmon.pid\"\n\nMAXWAIT=30\n\n#后续部分省略\n</code></pre><h3 id=\"34、服务操作\" class=\"calibre9\">3.4、服务操作</h3>\n<p class=\"calibre12\">启动服务：</p>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">/etc/init.d/collectd start\n</code></pre><p class=\"calibre12\">停止服务：</p>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">/etc/init.d/collectd stop\n</code></pre><p class=\"calibre12\">重启服务：</p>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">/etc/init.d/collectd restart\n</code></pre><p class=\"calibre12\">启动还有问题，需要排查原因\n通过这两个命令进行排查</p>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">systemctl status collectd.service\njournalctl -xe\n</code></pre><h3 id=\"35、设置开机自启动\" class=\"calibre9\">3.5、设置开机自启动</h3>\n<p class=\"calibre12\">查找自启动配置</p>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">chkconfig --list\n</code></pre><p class=\"calibre12\">为collect添加自启动</p>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">chkconfig collectd on\n</code></pre><h2 id=\"4、修改配置文件\" class=\"calibre13\">4、修改配置文件</h2>\n<p class=\"calibre12\">通过修改配置文件，调整监控内容，配置文件目录：<code class=\"pcalibre5 pcalibre6 calibre19\">/opt/collectd/etc/collectd.conf</code></p>\n<p class=\"calibre12\">插件分为输出插件（input）、输出插件（output）、日志插件（log）。其中输入插件用来收集监控数据；输出插件用来将获得的数据进行保存或发送；日志插件用来记录collect程序本身的运行状况。</p>\n<h2 id=\"9、错误处理\" class=\"calibre13\">9、错误处理</h2>\n<h3 id=\"91、配置文件错误\" class=\"calibre9\">9.1、配置文件错误</h3>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">##启动服务提示错误\nservice collectd start \n##使用命令，查看错误详情\nsystemctl status collectd.service\n</code></pre><pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">collectd.service - SYSV: Collectd is a statistics gathering daemon used to collect system information ie. cpu, memory, disk, network\n   Loaded: loaded (/etc/rc.d/init.d/collectd)\n   Active: failed (Result: resources) since 四 2016-08-04 15:13:52 CST; 4min 20s ago\n     Docs: man:systemd-sysv-generator(8)\n  Process: 27156 ExecStart=/etc/rc.d/init.d/collectd start (code=exited, status=0/SUCCESS)\n\n8月 04 15:13:52 localhost.localdomain systemd[1]: Starting SYSV: Collectd is a statistics gathering daemon used to collect system information ie. cpu, memory, disk, network...\n8月 04 15:13:52 localhost.localdomain collectd[27156]: Starting collectd: not starting due to configuration error\n8月 04 15:13:52 localhost.localdomain collectd[27156]: [失败]\n8月 04 15:13:52 localhost.localdomain systemd[1]: PID file /var/run/collectd.pid not readable (yet?) after start.\n8月 04 15:13:52 localhost.localdomain systemd[1]: Failed to start SYSV: Collectd is a statistics gathering daemon used to collect system information ie. cpu, memory, disk, network.\n8月 04 15:13:52 localhost.localdomain systemd[1]: Unit collectd.service entered failed state.\n8月 04 15:13:52 localhost.localdomain systemd[1]: collectd.service failed.\n</code></pre><p class=\"calibre12\">解决办法：</p>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">/etc/init.d/collectd\n</code></pre><p class=\"calibre12\">配置文件中的文件路径进行检查，确保执行实际的collect相关文件</p>\n<h3 id=\"92、collectdmon程序找不到问题\" class=\"calibre9\">9.2、collectdmon程序找不到问题</h3>\n<p class=\"calibre12\">错误提示：</p>\n<p class=\"calibre12\">解决办法：\n在<code class=\"pcalibre5 pcalibre6 calibre19\">/etc/init.d/collectd</code>文件中将collectdmon程序的路径补充完整</p>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">prog=\"/opt/collectd/sbin/collectdmon\"\n</code></pre><h3 id=\"93、\" class=\"calibre9\">9.3、</h3>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\"> collectd.service - SYSV: Collectd is a statistics gathering daemon used to collect system information ie. cpu, memory, disk, network\n   Loaded: loaded (/etc/rc.d/init.d/collectd)\n   Active: failed (Result: timeout) since 四 2016-08-04 15:53:11 CST; 15min ago\n     Docs: man:systemd-sysv-generator(8)\n  Process: 2156 ExecStart=/etc/rc.d/init.d/collectd start (code=exited, status=0/SUCCESS)\n   CGroup: /system.slice/collectd.service\n           ├─2161 /opt/collectd/sbin/collectdmon -P /var/run/collectdmon.pid -c /opt/collectd/sbin/collectd -- -C /opt/collectd/etc/collectd.conf\n           └─2163 /opt/collectd/sbin/collectd -C /opt/collectd/etc/collectd.conf -f\n\n8月 04 15:48:11 localhost.localdomain systemd[1]: Starting SYSV: Collectd is a statistics gathering daemon used to collect system information ie. cpu, memory, disk, network...\n8月 04 15:48:11 localhost.localdomain runuser[2158]: pam_unix(runuser:session): session opened for user root by (uid=0)\n8月 04 15:48:11 localhost.localdomain collectd[2156]: Starting collectd: [  确定  ]\n8月 04 15:48:11 localhost.localdomain systemd[1]: PID file /var/run/collectd.pid not readable (yet?) after start.\n8月 04 15:48:11 localhost.localdomain collectd[2163]: Initialization complete, entering read-loop.\n8月 04 15:48:11 localhost.localdomain collectd[2163]: rrdtool plugin: Adjusting \"RandomTimeout\" to 0.000 seconds.\n8月 04 15:53:11 localhost.localdomain systemd[1]: collectd.service start operation timed out. Terminating.\n8月 04 15:53:11 localhost.localdomain systemd[1]: Failed to start SYSV: Collectd is a statistics gathering daemon used to collect system information ie. cpu, memory, disk, network.\n8月 04 15:53:11 localhost.localdomain systemd[1]: Unit collectd.service entered failed state.\n8月 04 15:53:11 localhost.localdomain systemd[1]: collectd.service failed.\n</code></pre>\n        </div>\n    \n</div>\n\n        \n    \n\n\n\n",
  "slug": 6588816,
  "title": "523001_jiang_collectd_zuo_wei_input_shu_ru"
}