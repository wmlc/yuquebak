{
  "body_html": "\n\n  \n    syslog 输入配置\n    \n    \n    \n    \n    \n  <link href=\"https://www.yuque.com/attachments/yuque/0/2020/css/491128/1588213910235-976bcd3a-7a9c-473d-b800-1b1df54807d4.css\" rel=\"stylesheet\" type=\"text/css\" />\n<link href=\"https://www.yuque.com/attachments/yuque/0/2020/css/491128/1588213910286-64db0dd0-ac29-46fb-9241-76ef318b1b53.css\" rel=\"stylesheet\" type=\"text/css\" />\n\n  \n        \n<div class=\"page\">\n    \n        <h1 class=\"book-chapter\" id=\"calibre_toc_15\">syslog 输入配置</h1>\n        <div class=\"section\">\n            <h1 id=\"53、syslog-输入配置\" class=\"calibre7\">5.3、syslog 输入配置</h1>\n<h2 id=\"1、接收本地的syslog日志\" class=\"calibre8\">1、接收本地的syslog日志</h2>\n<h3 id=\"11、logstash配置\" class=\"calibre9\">1.1、logstash配置</h3>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\"># The # character at the beginning of a line indicates a comment. Use\n# comments to describe your configuration.\ninput\n{\n    stdin {}\n    syslog \n    {\n        port =&gt;\"514\"\n    }\n}\n# The filter part of this file is commented out to indicate that it is\n# optional.\n# filter {\n#\n# }\noutput\n{\n    stdout {}    \n    stdout {codec=&gt;rubydebug}\n}\n</code></pre><p class=\"calibre12\">在input 字段中增加syslog配置，将端口设置成syslog协议的默认端口514</p>\n<h3 id=\"12、对rsyslogd程序进行配置\" class=\"calibre9\">1.2、对rsyslogd程序进行配置</h3>\n<p class=\"calibre12\">rsyslogd的配置文件位于/etc/rsyslog.conf，默认的配置内容如下：</p>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\"># rsyslog configuration file\n\n# For more information see /usr/share/doc/rsyslog-*/rsyslog_conf.html\n# If you experience problems, see http://www.rsyslog.com/doc/troubleshoot.html\n\n#### MODULES ####\n\n# The imjournal module bellow is now used as a message source instead of imuxsock.\n$ModLoad imuxsock # provides support for local system logging (e.g. via logger command)\n$ModLoad imjournal # provides access to the systemd journal\n#$ModLoad imklog # reads kernel messages (the same are read from journald)\n#$ModLoad immark  # provides --MARK-- message capability\n\n# Provides UDP syslog reception\n#$ModLoad imudp\n#$UDPServerRun 514\n\n# Provides TCP syslog reception\n#$ModLoad imtcp\n#$InputTCPServerRun 514\n\n\n#### GLOBAL DIRECTIVES ####\n\n# Where to place auxiliary files\n$WorkDirectory /var/lib/rsyslog\n\n# Use default timestamp format\n$ActionFileDefaultTemplate RSYSLOG_TraditionalFileFormat\n\n# File syncing capability is disabled by default. This feature is usually not required,\n# not useful and an extreme performance hit\n#$ActionFileEnableSync on\n\n# Include all config files in /etc/rsyslog.d/\n$IncludeConfig /etc/rsyslog.d/*.conf\n\n# Turn off message reception via local log socket;\n# local messages are retrieved through imjournal now.\n$OmitLocalLogging on\n\n# File to store the position in the journal\n$IMJournalStateFile imjournal.state\n\n\n#### RULES ####\n\n# Log all kernel messages to the console.\n# Logging much else clutters up the screen.\n#kern.*                                                 /dev/console\n\n# Log anything (except mail) of level info or higher.\n# Don't log private authentication messages!\n*.info;mail.none;authpriv.none;cron.none                /var/log/messages\n\n# The authpriv file has restricted access.\nauthpriv.*                                              /var/log/secure\n\n# Log all the mail messages in one place.\nmail.*                                                  -/var/log/maillog\n\n\n# Log cron stuff\ncron.*                                                  /var/log/cron\n\n# Everybody gets emergency messages\n*.emerg                                                 :omusrmsg:*\n\n# Save news errors of level crit and higher in a special file.\nuucp,news.crit                                          /var/log/spooler\n\n# Save boot messages also to boot.log\nlocal7.*                                                /var/log/boot.log\n\n\n# ### begin forwarding rule ###\n# The statement between the begin ... end define a SINGLE forwarding\n# rule. They belong together, do NOT split them. If you create multiple\n# forwarding rules, duplicate the whole block!\n# Remote Logging (we use TCP for reliable delivery)\n#\n# An on-disk queue is created for this action. If the remote host is\n# down, messages are spooled to disk and sent when it is up again.\n#$ActionQueueFileName fwdRule1 # unique name prefix for spool files\n#$ActionQueueMaxDiskSpace 1g   # 1gb space limit (use as much as possible)\n#$ActionQueueSaveOnShutdown on # save messages to disk on shutdown\n#$ActionQueueType LinkedList   # run asynchronously\n#$ActionResumeRetryCount -1    # infinite retries if host is down\n# remote host is: name/ip:port, e.g. 192.168.0.1:514, port optional\n#*.* @@remote-host:514\n# ### end of the forwarding rule ###\n</code></pre><p class=\"calibre12\">在配置文件的最后增加一条配置项</p>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">*.*     @@10.130.203.4:514\n</code></pre><p class=\"calibre12\">其中需要注意的是：</p>\n<ul class=\"calibre17\">\n<li class=\"calibre18\">\"@@\"前需要是TAB符号 【是否必须未做过验证】</li>\n<li class=\"calibre18\">\"@@\"后紧跟的是当前服务器的ip地址，这里当前的ip地址是：10.130.203.4，也可以配置成127.0.0.1来表示本地日志。</li>\n<li class=\"calibre18\">\":\"后设置的是当前logstash用于接收syslog日志所开放的端口，这里是514</li>\n</ul>\n<h3 id=\"13、重启rsyslogd应用\" class=\"calibre9\">1.3、重启rsyslogd应用</h3>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">service rsyslog restart\n</code></pre><h3 id=\"14、运行logstash程序\" class=\"calibre9\">1.4、运行logstash程序</h3>\n<p class=\"calibre12\">运行如下命令启动logstash</p>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">./logstash -f /etc/logstash/conf.d/test_syslog_1.conf\n</code></pre><h3 id=\"15、通过logger命令测试日志收集\" class=\"calibre9\">1.5、通过logger命令测试日志收集</h3>\n<h3 id=\"16、通过telnet命令测试日志收集\" class=\"calibre9\">1.6、通过telnet命令测试日志收集</h3>\n<h2 id=\"2、接收远程的syslog日志\" class=\"calibre13\">2、接收远程的syslog日志</h2>\n<p class=\"calibre12\">比如要在10.130.203.5服务器上配置syslog客户端，将日志上传到10.130.203.4的服务器上。</p>\n<h3 id=\"21、服务端配置\" class=\"calibre9\">2.1、服务端配置</h3>\n<p class=\"calibre12\">在10.130.203.4服务器上，按照1.1中接收本地syslog日志的方式进行配置。</p>\n<h3 id=\"22、客户端配置\" class=\"calibre9\">2.2、客户端配置</h3>\n<p class=\"calibre12\">在10.130.203.5服务器的/etc/rsyslog.conf配置文件最后增加如下配置：</p>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">*.*     @@10.130.203.4:514\n</code></pre><ul class=\"calibre17\">\n<li class=\"calibre18\">在10.130.203.5服务器上，对syslog服务进行重启</li>\n</ul>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">service rsyslog restart\n</code></pre><h3 id=\"23、logger方式测试日志收集\" class=\"calibre9\">2.3、logger方式测试日志收集</h3>\n<h3 id=\"24、telnet方式测试日志收集\" class=\"calibre9\">2.4、telnet方式测试日志收集</h3>\n<h2 id=\"3、实际数据数据\" class=\"calibre13\">3、实际数据数据</h2>\n<p class=\"calibre12\">secure日志：</p>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">Jul 25 09:22:09 t0-security-tdas02 sshd[13903]: Accepted password for root from 10.136.17.21 port 50153 ssh2\nJul 25 09:22:09 t0-security-tdas02 sshd[13903]: pam_unix(sshd:session): session opened for user root by (uid=0)\nJul 25 09:24:54 t0-security-tdas02 sshd[13903]: pam_unix(sshd:session): session closed for user root\nJul 25 13:03:56 t0-security-tdas02 sshd[15185]: Received disconnect from 10.135.52.138: 11: disconnected by user\nJul 25 13:03:56 t0-security-tdas02 sshd[15185]: pam_unix(sshd:session): session closed for user root\nJul 25 13:03:56 t0-security-tdas02 sshd[14990]: Received disconnect from 10.135.52.138: 11: disconnected by user\nJul 25 13:03:56 t0-security-tdas02 sshd[14990]: pam_unix(sshd:session): session closed for user root\nJul 26 14:41:58 t0-security-tdas02 sshd[24520]: Accepted password for root from 10.135.52.138 port 53759 ssh2\nJul 26 14:41:58 t0-security-tdas02 sshd[24520]: pam_unix(sshd:session): session opened for user root by (uid=0)\nJul 26 14:59:15 t0-security-tdas02 sshd[24520]: Received disconnect from 10.135.52.138: 11: disconnected by user\nJul 26 14:59:15 t0-security-tdas02 sshd[24520]: pam_unix(sshd:session): session closed for user root\nJul 26 17:23:28 t0-security-tdas02 sshd[28496]: Accepted password for root from 10.135.52.137 port 43502 ssh2\nJul 26 17:23:28 t0-security-tdas02 sshd[28496]: pam_unix(sshd:session): session opened for user root by (uid=0)\n</code></pre><p class=\"calibre12\">messages日志</p>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">Jul 26 14:01:01 t0-security-tdas02 systemd: Starting user-0.slice.\nJul 26 14:01:01 t0-security-tdas02 systemd: Started Session 154 of user root.\nJul 26 14:01:01 t0-security-tdas02 systemd: Starting Session 154 of user root.\nJul 26 14:01:01 t0-security-tdas02 systemd: Removed slice user-0.slice.\nJul 26 14:01:01 t0-security-tdas02 systemd: Stopping user-0.slice.\nJul 26 14:41:58 t0-security-tdas02 systemd: Created slice user-0.slice.\nJul 26 14:41:58 t0-security-tdas02 systemd: Starting user-0.slice.\nJul 26 14:41:58 t0-security-tdas02 systemd-logind: New session 155 of user root.\nJul 26 14:41:58 t0-security-tdas02 systemd: Started Session 155 of user root.\nJul 26 14:41:58 t0-security-tdas02 systemd: Starting Session 155 of user root.\nJul 26 14:42:47 t0-security-tdas02 yum[24561]: Installed: ftp-0.17-66.el7.x86_64\nJul 26 14:59:15 t0-security-tdas02 systemd-logind: Removed session 155.\nJul 26 14:59:15 t0-security-tdas02 systemd: Removed slice user-0.slice.\nJul 26 14:59:15 t0-security-tdas02 systemd: Stopping user-0.slice.\nJul 26 15:01:01 t0-security-tdas02 systemd: Created slice user-0.slice.\nJul 26 15:01:01 t0-security-tdas02 systemd: Starting user-0.slice.\nJul 26 15:01:01 t0-security-tdas02 systemd: Started Session 156 of user root.\nJul 26 15:01:01 t0-security-tdas02 systemd: Starting Session 156 of user root.\nJul 26 15:01:01 t0-security-tdas02 systemd: Removed slice user-0.slice.\nJul 26 15:01:01 t0-security-tdas02 systemd: Stopping user-0.slice.\nJul 26 16:01:01 t0-security-tdas02 systemd: Created slice user-0.slice.\nJul 26 16:01:01 t0-security-tdas02 systemd: Starting user-0.slice.\nJul 26 16:01:01 t0-security-tdas02 systemd: Started Session 157 of user root.\nJul 26 16:01:01 t0-security-tdas02 systemd: Starting Session 157 of user root.\nJul 26 16:01:01 t0-security-tdas02 systemd: Removed slice user-0.slice.\nJul 26 16:01:01 t0-security-tdas02 systemd: Stopping user-0.slice.\nJul 26 17:01:01 t0-security-tdas02 systemd: Created slice user-0.slice.\nJul 26 17:01:01 t0-security-tdas02 systemd: Starting user-0.slice.\nJul 26 17:01:01 t0-security-tdas02 systemd: Started Session 158 of user root.\nJul 26 17:01:01 t0-security-tdas02 systemd: Starting Session 158 of user root.\nJul 26 17:01:01 t0-security-tdas02 systemd: Removed slice user-0.slice.\nJul 26 17:01:01 t0-security-tdas02 systemd: Stopping user-0.slice.\nJul 26 17:23:28 t0-security-tdas02 systemd: Created slice user-0.slice.\nJul 26 17:23:28 t0-security-tdas02 systemd: Starting user-0.slice.\nJul 26 17:23:28 t0-security-tdas02 systemd: Started Session 159 of user root.\nJul 26 17:23:28 t0-security-tdas02 systemd-logind: New session 159 of user root.\nJul 26 17:23:28 t0-security-tdas02 systemd: Starting Session 159 of user root.\nJul 26 17:23:32 t0-security-tdas02 root: 1111\n</code></pre><p class=\"calibre12\">logstash输出数据</p>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">\n{\n           \"message\" =&gt; \"Accepted password for root from 10.135.52.137 port 43502 ssh2\\n\",\n          \"@version\" =&gt; \"1\",\n        \"@timestamp\" =&gt; \"2016-07-26T09:23:28.000Z\",\n              \"host\" =&gt; \"10.130.203.5\",\n          \"priority\" =&gt; 86,\n         \"timestamp\" =&gt; \"Jul 26 17:23:28\",\n         \"logsource\" =&gt; \"t0-security-tdas02\",\n           \"program\" =&gt; \"sshd\",\n               \"pid\" =&gt; \"28496\",\n          \"severity\" =&gt; 6,\n          \"facility\" =&gt; 10,\n    \"facility_label\" =&gt; \"security/authorization\",\n    \"severity_label\" =&gt; \"Informational\"\n}\n{\n           \"message\" =&gt; \"Created slice user-0.slice.\\n\",\n          \"@version\" =&gt; \"1\",\n        \"@timestamp\" =&gt; \"2016-07-26T09:23:28.000Z\",\n              \"host\" =&gt; \"10.130.203.5\",\n          \"priority\" =&gt; 30,\n         \"timestamp\" =&gt; \"Jul 26 17:23:28\",\n         \"logsource\" =&gt; \"t0-security-tdas02\",\n           \"program\" =&gt; \"systemd\",\n          \"severity\" =&gt; 6,\n          \"facility\" =&gt; 3,\n    \"facility_label\" =&gt; \"system\",\n    \"severity_label\" =&gt; \"Informational\"\n}\n{\n           \"message\" =&gt; \"Starting user-0.slice.\\n\",\n          \"@version\" =&gt; \"1\",\n        \"@timestamp\" =&gt; \"2016-07-26T09:23:28.000Z\",\n              \"host\" =&gt; \"10.130.203.5\",\n          \"priority\" =&gt; 30,\n         \"timestamp\" =&gt; \"Jul 26 17:23:28\",\n         \"logsource\" =&gt; \"t0-security-tdas02\",\n           \"program\" =&gt; \"systemd\",\n          \"severity\" =&gt; 6,\n          \"facility\" =&gt; 3,\n    \"facility_label\" =&gt; \"system\",\n    \"severity_label\" =&gt; \"Informational\"\n}\n{\n           \"message\" =&gt; \"Started Session 159 of user root.\\n\",\n          \"@version\" =&gt; \"1\",\n        \"@timestamp\" =&gt; \"2016-07-26T09:23:28.000Z\",\n              \"host\" =&gt; \"10.130.203.5\",\n          \"priority\" =&gt; 30,\n         \"timestamp\" =&gt; \"Jul 26 17:23:28\",\n         \"logsource\" =&gt; \"t0-security-tdas02\",\n           \"program\" =&gt; \"systemd\",\n          \"severity\" =&gt; 6,\n          \"facility\" =&gt; 3,\n    \"facility_label\" =&gt; \"system\",\n    \"severity_label\" =&gt; \"Informational\"\n}\n{\n           \"message\" =&gt; \"New session 159 of user root.\\n\",\n          \"@version\" =&gt; \"1\",\n        \"@timestamp\" =&gt; \"2016-07-26T09:23:28.000Z\",\n              \"host\" =&gt; \"10.130.203.5\",\n          \"priority\" =&gt; 38,\n         \"timestamp\" =&gt; \"Jul 26 17:23:28\",\n         \"logsource\" =&gt; \"t0-security-tdas02\",\n           \"program\" =&gt; \"systemd-logind\",\n          \"severity\" =&gt; 6,\n          \"facility\" =&gt; 4,\n    \"facility_label\" =&gt; \"security/authorization\",\n    \"severity_label\" =&gt; \"Informational\"\n}\n{\n           \"message\" =&gt; \"Starting Session 159 of user root.\\n\",\n          \"@version\" =&gt; \"1\",\n        \"@timestamp\" =&gt; \"2016-07-26T09:23:28.000Z\",\n              \"host\" =&gt; \"10.130.203.5\",\n          \"priority\" =&gt; 30,\n         \"timestamp\" =&gt; \"Jul 26 17:23:28\",\n         \"logsource\" =&gt; \"t0-security-tdas02\",\n           \"program\" =&gt; \"systemd\",\n          \"severity\" =&gt; 6,\n          \"facility\" =&gt; 3,\n    \"facility_label\" =&gt; \"system\",\n    \"severity_label\" =&gt; \"Informational\"\n}\n{\n           \"message\" =&gt; \"pam_unix(sshd:session): session opened for user root by (uid=0)\\n\",\n          \"@version\" =&gt; \"1\",\n        \"@timestamp\" =&gt; \"2016-07-26T09:23:28.000Z\",\n              \"host\" =&gt; \"10.130.203.5\",\n          \"priority\" =&gt; 86,\n         \"timestamp\" =&gt; \"Jul 26 17:23:28\",\n         \"logsource\" =&gt; \"t0-security-tdas02\",\n           \"program\" =&gt; \"sshd\",\n               \"pid\" =&gt; \"28496\",\n          \"severity\" =&gt; 6,\n          \"facility\" =&gt; 10,\n    \"facility_label\" =&gt; \"security/authorization\",\n    \"severity_label\" =&gt; \"Informational\"\n}\n2016-07-26T09:23:32.000Z 10.130.203.5 1111\n\n{\n           \"message\" =&gt; \"1111\\n\",\n          \"@version\" =&gt; \"1\",\n        \"@timestamp\" =&gt; \"2016-07-26T09:23:32.000Z\",\n              \"host\" =&gt; \"10.130.203.5\",\n          \"priority\" =&gt; 13,\n         \"timestamp\" =&gt; \"Jul 26 17:23:32\",\n         \"logsource\" =&gt; \"t0-security-tdas02\",\n           \"program\" =&gt; \"root\",\n          \"severity\" =&gt; 5,\n          \"facility\" =&gt; 1,\n    \"facility_label\" =&gt; \"user-level\",\n    \"severity_label\" =&gt; \"Notice\"\n}\n</code></pre>\n        </div>\n    \n</div>\n\n        \n    \n\n\n\n",
  "slug": 6588817,
  "title": "53syslog_shu_ru_pei_zhi"
}