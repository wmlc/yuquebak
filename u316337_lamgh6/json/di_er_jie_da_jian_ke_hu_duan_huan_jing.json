{
  "body_html": "\n\n  \n    第二节 搭建客户端环境\n    \n    \n    \n    \n    \n  <link href=\"https://www.yuque.com/attachments/yuque/0/2020/css/491128/1588213910235-976bcd3a-7a9c-473d-b800-1b1df54807d4.css\" rel=\"stylesheet\" type=\"text/css\" />\n<link href=\"https://www.yuque.com/attachments/yuque/0/2020/css/491128/1588213910286-64db0dd0-ac29-46fb-9241-76ef318b1b53.css\" rel=\"stylesheet\" type=\"text/css\" />\n\n  \n        \n<div class=\"page\">\n    \n        <h1 class=\"book-chapter\" id=\"calibre_toc_47\">第二节 搭建客户端环境</h1>\n        <div class=\"section\">\n            <h1 id=\"第二节-搭建客户端环境\" class=\"calibre7\">第二节 搭建客户端环境</h1>\n<h2 id=\"1、安装nginx\" class=\"calibre8\">1、安装Nginx</h2>\n<h3 id=\"11、查看当前的redhat版本\" class=\"calibre9\">1.1、查看当前的redhat版本</h3>\n<h3 id=\"12、安装nginx的yum源\" class=\"calibre9\">1.2、安装nginx的yum源</h3>\n<p class=\"calibre12\">这里需要注意，根据redhat不同的版本需要安装不同的yum源，这里是系统是redhat 7 所以安装的yum源的版本也是7</p>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">rpm -ivh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm\n</code></pre><p class=\"calibre12\">页面展示：\n<img alt src=\"https://cdn.nlark.com/yuque/0/2020/png/491128/1588213919182-87901b38-5b78-446b-b653-cf7b13bf7e8c.png\" class=\"calibre14\" /></p>\n<h3 id=\"13、查看nginx-信息\" class=\"calibre9\">1.3、查看nginx 信息</h3>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">yum info nginx\n</code></pre><p class=\"calibre12\">展示信息：\n<img alt src=\"https://cdn.nlark.com/yuque/0/2020/png/491128/1588213919242-3277d38e-56be-4f79-afc1-b740ae240b46.png\" class=\"calibre14\" /></p>\n<h3 id=\"14、安装\" class=\"calibre9\">1.4、安装</h3>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">yum install nginx\n</code></pre><p class=\"calibre12\"><img alt src=\"https://cdn.nlark.com/yuque/0/2020/png/491128/1588213919281-d0758f9f-06fe-4c4f-a977-e3d00db47b83.png\" class=\"calibre14\" /></p>\n<h3 id=\"15、启动\" class=\"calibre9\">1.5、启动</h3>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">service nginx start\n</code></pre><p class=\"calibre12\"><img alt src=\"https://cdn.nlark.com/yuque/0/2020/png/491128/1588213919322-78968c5f-d91a-4ca9-af7f-2fd8cb33486d.png\" class=\"calibre14\" /></p>\n<p class=\"calibre12\"><img alt src=\"https://cdn.nlark.com/yuque/0/2020/png/491128/1588213919367-1798b339-d8d9-4678-a666-a70c24f6d400.png\" class=\"calibre14\" /></p>\n<h3 id=\"16、其他操作\" class=\"calibre9\">1.6、其他操作</h3>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">service nginx stop\nservice nginx reload\n</code></pre><h3 id=\"17、相关默认配置信息\" class=\"calibre9\">1.7、相关默认配置信息</h3>\n<ul class=\"calibre17\">\n<li class=\"calibre18\">配置文件位置</li>\n</ul>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">/etc/nginx/nginx.conf\n</code></pre><ul class=\"calibre17\">\n<li class=\"calibre18\">错误日志路径</li>\n</ul>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">#参见nginx.conf配置文件\nerror_log  /var/log/nginx/error.log warn;\n</code></pre><ul class=\"calibre17\">\n<li class=\"calibre18\">访问日志文件路径</li>\n</ul>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">#参见nginx.conf配置文件\naccess_log  /var/log/nginx/access.log  main;\n</code></pre><ul class=\"calibre17\">\n<li class=\"calibre18\">日志格式</li>\n</ul>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">#参见nginx.conf配置文件\nlog_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                      '$status $body_bytes_sent \"$http_referer\" '\n                      '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n</code></pre><ul class=\"calibre17\">\n<li class=\"calibre18\">引入其他配置文件</li>\n</ul>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">#参见nginx.conf配置文件\ninclude /etc/nginx/conf.d/*.conf;\n</code></pre><ul class=\"calibre17\">\n<li class=\"calibre18\">web目录位置</li>\n</ul>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">#参见/etc/nginx/default.conf 文件中的配置\nlocation / {\n        root   /usr/share/nginx/html;\n        index  index.html index.htm;\n    }\n</code></pre><pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">/usr/share/nginx/html\n\n[anbc@localhost html]$ ll\n总用量 8\n-rw-r--r--. 1 root root 537 5月  31 22:09 50x.html\n-rw-r--r--. 1 root root 612 5月  31 22:09 index.html\n</code></pre><h2 id=\"2、安装logstash客户端\" class=\"calibre13\">2、安装Logstash客户端</h2>\n<p class=\"calibre12\">详见第一章 第二节</p>\n<h2 id=\"3、配置redis输出\" class=\"calibre13\">3、配置redis输出</h2>\n<p class=\"calibre12\">通过配置redis输出，将数据输出到远程的redis服务器上。</p>\n<h1 id=\"4、遇到的问题\" class=\"calibre7\">4、遇到的问题</h1>\n<h2 id=\"41、日志文件权限问题\" class=\"calibre8\">4.1、日志文件权限问题</h2>\n<p class=\"calibre12\"><strong class=\"calibre16\">问题描述：</strong></p>\n<p class=\"calibre12\">nginx日志权限为：</p>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">[anbc@localhost sbin]$ cd /var/log/nginx/\n[anbc@localhost nginx]$ ll\n总用量 16\n-rw-r-----. 1 nginx adm 1017 7月   6 18:50 access.log\n-rw-r-----. 1 nginx adm  878 7月   6 13:30 access.log-20160706\n-rw-r-----. 1 nginx adm  214 7月   6 14:44 error.log\n-rw-r-----. 1 nginx adm  522 7月   6 13:30 error.log-20160706\n</code></pre><p class=\"calibre12\">只给了用户nginx和用户组adm以读权限。</p>\n<p class=\"calibre12\">Logstash进程的运行权限为：</p>\n<p class=\"calibre12\"><img alt src=\"https://cdn.nlark.com/yuque/0/2020/png/491128/1588213919424-dbee1035-146c-4c1b-a494-8cc30de33498.png\" class=\"calibre14\" /></p>\n<p class=\"calibre12\">logstash以anbc用户运行，没有读取access.log等文件的权限。</p>\n<p class=\"calibre12\"><strong class=\"calibre16\">问题解决：</strong></p>\n<p class=\"calibre12\">(1)、将logstash用户加入adm用户组</p>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">sudo gpasswd -a logstash adm\n</code></pre><p class=\"calibre12\">(2)、使用一下命令，以“logstash”用户权限运行”logstash“进程。</p>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">sudo -u logstash /opt/logstash/bin/logstash -f /etc/logstash/conf.d/client.conf\n</code></pre>\n        </div>\n    \n</div>\n\n        \n    \n\n\n\n",
  "slug": 6588851,
  "title": "di_er_jie_da_jian_ke_hu_duan_huan_jing"
}