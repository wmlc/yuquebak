{
  "body_html": "\n\n  \n    第一节 部署\n    \n    \n    \n    \n    \n  <link href=\"https://www.yuque.com/attachments/yuque/0/2020/css/491128/1588213910235-976bcd3a-7a9c-473d-b800-1b1df54807d4.css\" rel=\"stylesheet\" type=\"text/css\" />\n<link href=\"https://www.yuque.com/attachments/yuque/0/2020/css/491128/1588213910286-64db0dd0-ac29-46fb-9241-76ef318b1b53.css\" rel=\"stylesheet\" type=\"text/css\" />\n\n  \n        \n<div class=\"page\">\n    \n        <h1 class=\"book-chapter\" id=\"calibre_toc_46\">第一节 部署</h1>\n        <div class=\"section\">\n            <h1 id=\"第一节-单elasticsearch单input部署\" class=\"calibre7\">第一节 单Elasticsearch单input部署</h1>\n<h2 id=\"1、文件数据进入elasticsearch\" class=\"calibre8\">1、文件数据进入Elasticsearch</h2>\n<h3 id=\"11、配置文件\" class=\"calibre9\">1.1、配置文件</h3>\n<p class=\"calibre12\">test_elasticsearch.conf</p>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">\ninput\n{   \n    file\n    {\n        path =&gt;\"/home/anbc/test/logstash-tutorial.log\"\n        start_position =&gt;beginning\n        ignore_older =&gt; 0\n    }\n}\n\nfilter\n{\n    grok\n    {\n         match =&gt;{\"message\" =&gt; \"%{COMBINEDAPACHELOG}\"}\n    }\n}\n\noutput\n{\n    stdout\n    {\n\n    }\n\n    elasticsearch\n    {\n\n    }\n\n}\n</code></pre><h3 id=\"12、运行elasticsearch\" class=\"calibre9\">1.2、运行Elasticsearch</h3>\n<p class=\"calibre12\">执行下面命令：</p>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">/opt/elasticsearch/bin/elasticsearch\n</code></pre><p class=\"calibre12\">了解更详细的Elasticsearch安装配置信息，参见《第二章 Elasticsearch使用手册》中的《第二节 安装》</p>\n<h3 id=\"13、测试命令\" class=\"calibre9\">1.3、测试命令</h3>\n<p class=\"calibre12\">执行命令：</p>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">/opt/logstash/bin/logstash -f /etc/logstash/conf.d/test_elasticsearch.conf --configtest\n</code></pre><p class=\"calibre12\">执行结果：\n<img alt src=\"https://cdn.nlark.com/yuque/0/2020/png/491128/1588213928565-ff3f27a9-3929-42eb-b0be-64eded9bdce3.png\" class=\"calibre14\" /></p>\n<h3 id=\"14、执行命令\" class=\"calibre9\">1.4、执行命令</h3>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">/opt/logstash/bin/logstash -f /etc/logstash/conf.d/test_elasticsearch.conf\n</code></pre><p class=\"calibre12\">如果获得更详细的调试信息，可以增加参数<code class=\"pcalibre5 pcalibre6 calibre19\">--debug</code> 或 <code class=\"pcalibre5 pcalibre6 calibre19\">--verbose</code>如下所示：</p>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">/opt/logstash/bin/logstash -f /etc/logstash/conf.d/test_elasticsearch.conf --debug\n</code></pre><h3 id=\"15、验证数据是否存储成功\" class=\"calibre9\">1.5、验证数据是否存储成功</h3>\n<p class=\"calibre12\">添加成功后，索引名称为：<code class=\"pcalibre5 pcalibre6 calibre19\">logstash-2016.06.08</code>，类型名称为：<code class=\"pcalibre5 pcalibre6 calibre19\">logs</code></p>\n<p class=\"calibre12\">通过查询Elasticsearch中的索引信息来判断，执行命令</p>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">curl 'localhost:9200/_cat/indices?v'\n</code></pre><p class=\"calibre12\">返回信息中可以看到，ElasticSearch中增加了一个名为“logstash-2016.06.08”的索引：</p>\n<p class=\"calibre12\"><img alt src=\"https://cdn.nlark.com/yuque/0/2020/png/491128/1588213928655-3d117c67-bcf1-404c-a3e1-98b48f7cd25e.png\" class=\"calibre14\" /></p>\n<p class=\"calibre12\">发送的请求：</p>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">curl -XGET 'localhost:9200/logstash-2016.06.08/_search?q=response=200'\n</code></pre><p class=\"calibre12\">返回的结果：</p>\n<pre class=\"calibre10\"><code class=\"pcalibre4 pcalibre3 calibre11\">{\n    \"took\": 1246,\n    \"timed_out\": false,\n    \"_shards\": {\n        \"total\": 5,\n        \"successful\": 5,\n        \"failed\": 0\n    },\n    \"hits\": {\n        \"total\": 98,\n        \"max_score\": 5.3242445,\n        \"hits\": [\n            {\n                \"_index\": \"logstash-2016.06.08\",\n                \"_type\": \"logs\",\n                \"_id\": \"AVUvp19T9IHRPCebL71F\",\n                \"_score\": 5.3242445,\n                \"_source\": {\n                    \"message\": \"83.149.9.216 - - [04/Jan/2015:05:13:45 +0000] \\\"GET /presentations/logstash-monitorama-2013/images/frontend-response-codes.png HTTP/1.1\\\" 200 52878 \\\"http://semicomplete.com/presentations/logstash-monitorama-2013/\\\" \\\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1700.77 Safari/537.36\\\"\",\n                    \"@version\": \"1\",\n                    \"@timestamp\": \"2016-06-08T10:55:41.486Z\",\n                    \"path\": \"/home/anbc/test/logstash-tutorial_1.log\",\n                    \"host\": \"localhost.localdomain\",\n                    \"clientip\": \"83.149.9.216\",\n                    \"ident\": \"-\",\n                    \"auth\": \"-\",\n                    \"timestamp\": \"04/Jan/2015:05:13:45 +0000\",\n                    \"verb\": \"GET\",\n                    \"request\": \"/presentations/logstash-monitorama-2013/images/frontend-response-codes.png\",\n                    \"httpversion\": \"1.1\",\n                    \"response\": \"200\",\n                    \"bytes\": \"52878\",\n                    \"referrer\": \"\\\"http://semicomplete.com/presentations/logstash-monitorama-2013/\\\"\",\n                    \"agent\": \"\\\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1700.77 Safari/537.36\\\"\"\n                }\n            },\n            {\n                \"_index\": \"logstash-2016.06.08\",\n                \"_type\": \"logs\",\n                \"_id\": \"AVUvp19U9IHRPCebL71K\",\n                \"_score\": 0.17486966,\n                \"_source\": {\n                    \"message\": \"83.149.9.216 - - [04/Jan/2015:05:13:46 +0000] \\\"GET /presentations/logstash-monitorama-2013/images/nagios-sms5.png HTTP/1.1\\\" 200 78075 \\\"http://semicomplete.com/presentations/logstash-monitorama-2013/\\\" \\\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1700.77 Safari/537.36\\\"\",\n                    \"@version\": \"1\",\n                    \"@timestamp\": \"2016-06-08T10:55:41.536Z\",\n                    \"path\": \"/home/anbc/test/logstash-tutorial_1.log\",\n                    \"host\": \"localhost.localdomain\",\n                    \"clientip\": \"83.149.9.216\",\n                    \"ident\": \"-\",\n                    \"auth\": \"-\",\n                    \"timestamp\": \"04/Jan/2015:05:13:46 +0000\",\n                    \"verb\": \"GET\",\n                    \"request\": \"/presentations/logstash-monitorama-2013/images/nagios-sms5.png\",\n                    \"httpversion\": \"1.1\",\n                    \"response\": \"200\",\n                    \"bytes\": \"78075\",\n                    \"referrer\": \"\\\"http://semicomplete.com/presentations/logstash-monitorama-2013/\\\"\",\n                    \"agent\": \"\\\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1700.77 Safari/537.36\\\"\"\n                }\n            },\n            {\n                \"_index\": \"logstash-2016.06.08\",\n                \"_type\": \"logs\",\n                \"_id\": \"AVUvp19U9IHRPCebL71N\",\n                \"_score\": 0.17486966,\n                \"_source\": {\n                    \"message\": \"83.149.9.216 - - [04/Jan/2015:05:13:47 +0000] \\\"GET /presentations/logstash-monitorama-2013/images/logstashbook.png HTTP/1.1\\\" 200 54662 \\\"http://semicomplete.com/presentations/logstash-monitorama-2013/\\\" \\\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1700.77 Safari/537.36\\\"\",\n                    \"@version\": \"1\",\n                    \"@timestamp\": \"2016-06-08T10:55:41.546Z\",\n                    \"path\": \"/home/anbc/test/logstash-tutorial_1.log\",\n                    \"host\": \"localhost.localdomain\",\n                    \"clientip\": \"83.149.9.216\",\n                    \"ident\": \"-\",\n                    \"auth\": \"-\",\n                    \"timestamp\": \"04/Jan/2015:05:13:47 +0000\",\n                    \"verb\": \"GET\",\n                    \"request\": \"/presentations/logstash-monitorama-2013/images/logstashbook.png\",\n                    \"httpversion\": \"1.1\",\n                    \"response\": \"200\",\n                    \"bytes\": \"54662\",\n                    \"referrer\": \"\\\"http://semicomplete.com/presentations/logstash-monitorama-2013/\\\"\",\n                    \"agent\": \"\\\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1700.77 Safari/537.36\\\"\"\n                }\n            },\n            {\n                \"_index\": \"logstash-2016.06.08\",\n                \"_type\": \"logs\",\n                \"_id\": \"AVUvp19U9IHRPCebL71Q\",\n                \"_score\": 0.17486966,\n                \"_source\": {\n                    \"message\": \"83.149.9.216 - - [04/Jan/2015:05:13:47 +0000] \\\"GET /presentations/logstash-monitorama-2013/images/1983_delorean_dmc-12-pic-38289.jpeg HTTP/1.1\\\" 200 220562 \\\"http://semicomplete.com/presentations/logstash-monitorama-2013/\\\" \\\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1700.77 Safari/537.36\\\"\",\n                    \"@version\": \"1\",\n                    \"@timestamp\": \"2016-06-08T10:55:41.585Z\",\n                    \"path\": \"/home/anbc/test/logstash-tutorial_1.log\",\n                    \"host\": \"localhost.localdomain\",\n                    \"clientip\": \"83.149.9.216\",\n                    \"ident\": \"-\",\n                    \"auth\": \"-\",\n                    \"timestamp\": \"04/Jan/2015:05:13:47 +0000\",\n                    \"verb\": \"GET\",\n                    \"request\": \"/presentations/logstash-monitorama-2013/images/1983_delorean_dmc-12-pic-38289.jpeg\",\n                    \"httpversion\": \"1.1\",\n                    \"response\": \"200\",\n                    \"bytes\": \"220562\",\n                    \"referrer\": \"\\\"http://semicomplete.com/presentations/logstash-monitorama-2013/\\\"\",\n                    \"agent\": \"\\\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1700.77 Safari/537.36\\\"\"\n                }\n            },\n            {\n                \"_index\": \"logstash-2016.06.08\",\n                \"_type\": \"logs\",\n                \"_id\": \"AVUvp19U9IHRPCebL71T\",\n                \"_score\": 0.17486966,\n                \"_source\": {\n                    \"message\": \"83.149.9.216 - - [04/Jan/2015:05:13:53 +0000] \\\"GET /favicon.ico HTTP/1.1\\\" 200 3638 \\\"-\\\" \\\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1700.77 Safari/537.36\\\"\",\n                    \"@version\": \"1\",\n                    \"@timestamp\": \"2016-06-08T10:55:41.610Z\",\n                    \"path\": \"/home/anbc/test/logstash-tutorial_1.log\",\n                    \"host\": \"localhost.localdomain\",\n                    \"clientip\": \"83.149.9.216\",\n                    \"ident\": \"-\",\n                    \"auth\": \"-\",\n                    \"timestamp\": \"04/Jan/2015:05:13:53 +0000\",\n                    \"verb\": \"GET\",\n                    \"request\": \"/favicon.ico\",\n                    \"httpversion\": \"1.1\",\n                    \"response\": \"200\",\n                    \"bytes\": \"3638\",\n                    \"referrer\": \"\\\"-\\\"\",\n                    \"agent\": \"\\\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1700.77 Safari/537.36\\\"\"\n                }\n            },\n            {\n                \"_index\": \"logstash-2016.06.08\",\n                \"_type\": \"logs\",\n                \"_id\": \"AVUvp19U9IHRPCebL71Y\",\n                \"_score\": 0.17486966,\n                \"_source\": {\n                    \"message\": \"93.114.45.13 - - [04/Jan/2015:05:14:33 +0000] \\\"GET /favicon.ico HTTP/1.1\\\" 200 3638 \\\"-\\\" \\\"Mozilla/5.0 (X11; Linux x86_64; rv:25.0) Gecko/20100101 Firefox/25.0\\\"\",\n                    \"@version\": \"1\",\n                    \"@timestamp\": \"2016-06-08T10:55:41.657Z\",\n                    \"path\": \"/home/anbc/test/logstash-tutorial_1.log\",\n                    \"host\": \"localhost.localdomain\",\n                    \"clientip\": \"93.114.45.13\",\n                    \"ident\": \"-\",\n                    \"auth\": \"-\",\n                    \"timestamp\": \"04/Jan/2015:05:14:33 +0000\",\n                    \"verb\": \"GET\",\n                    \"request\": \"/favicon.ico\",\n                    \"httpversion\": \"1.1\",\n                    \"response\": \"200\",\n                    \"bytes\": \"3638\",\n                    \"referrer\": \"\\\"-\\\"\",\n                    \"agent\": \"\\\"Mozilla/5.0 (X11; Linux x86_64; rv:25.0) Gecko/20100101 Firefox/25.0\\\"\"\n                }\n            },\n            {\n                \"_index\": \"logstash-2016.06.08\",\n                \"_type\": \"logs\",\n                \"_id\": \"AVUvp19U9IHRPCebL71a\",\n                \"_score\": 0.17486966,\n                \"_source\": {\n                    \"message\": \"93.114.45.13 - - [04/Jan/2015:05:14:33 +0000] \\\"GET /images/web/2009/banner.png HTTP/1.1\\\" 200 52315 \\\"http://www.semicomplete.com/style2.css\\\" \\\"Mozilla/5.0 (X11; Linux x86_64; rv:25.0) Gecko/20100101 Firefox/25.0\\\"\",\n                    \"@version\": \"1\",\n                    \"@timestamp\": \"2016-06-08T10:55:41.684Z\",\n                    \"path\": \"/home/anbc/test/logstash-tutorial_1.log\",\n                    \"host\": \"localhost.localdomain\",\n                    \"clientip\": \"93.114.45.13\",\n                    \"ident\": \"-\",\n                    \"auth\": \"-\",\n                    \"timestamp\": \"04/Jan/2015:05:14:33 +0000\",\n                    \"verb\": \"GET\",\n                    \"request\": \"/images/web/2009/banner.png\",\n                    \"httpversion\": \"1.1\",\n                    \"response\": \"200\",\n                    \"bytes\": \"52315\",\n                    \"referrer\": \"\\\"http://www.semicomplete.com/style2.css\\\"\",\n                    \"agent\": \"\\\"Mozilla/5.0 (X11; Linux x86_64; rv:25.0) Gecko/20100101 Firefox/25.0\\\"\"\n                }\n            },\n            {\n                \"_index\": \"logstash-2016.06.08\",\n                \"_type\": \"logs\",\n                \"_id\": \"AVUvp19V9IHRPCebL71d\",\n                \"_score\": 0.17486966,\n                \"_source\": {\n                    \"message\": \"66.249.73.185 - - [04/Jan/2015:05:15:23 +0000] \\\"GET / HTTP/1.1\\\" 200 37932 \\\"-\\\" \\\"Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)\\\"\",\n                    \"@version\": \"1\",\n                    \"@timestamp\": \"2016-06-08T10:55:41.708Z\",\n                    \"path\": \"/home/anbc/test/logstash-tutorial_1.log\",\n                    \"host\": \"localhost.localdomain\",\n                    \"clientip\": \"66.249.73.185\",\n                    \"ident\": \"-\",\n                    \"auth\": \"-\",\n                    \"timestamp\": \"04/Jan/2015:05:15:23 +0000\",\n                    \"verb\": \"GET\",\n                    \"request\": \"/\",\n                    \"httpversion\": \"1.1\",\n                    \"response\": \"200\",\n                    \"bytes\": \"37932\",\n                    \"referrer\": \"\\\"-\\\"\",\n                    \"agent\": \"\\\"Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)\\\"\"\n                }\n            },\n            {\n                \"_index\": \"logstash-2016.06.08\",\n                \"_type\": \"logs\",\n                \"_id\": \"AVUvp19V9IHRPCebL71g\",\n                \"_score\": 0.17486966,\n                \"_source\": {\n                    \"message\": \"110.136.166.128 - - [04/Jan/2015:05:16:22 +0000] \\\"GET /reset.css HTTP/1.1\\\" 200 1015 \\\"http://www.semicomplete.com/projects/xdotool/\\\" \\\"Mozilla/5.0 (Windows NT 6.2; WOW64; rv:28.0) Gecko/20100101 Firefox/28.0\\\"\",\n                    \"@version\": \"1\",\n                    \"@timestamp\": \"2016-06-08T10:55:41.731Z\",\n                    \"path\": \"/home/anbc/test/logstash-tutorial_1.log\",\n                    \"host\": \"localhost.localdomain\",\n                    \"clientip\": \"110.136.166.128\",\n                    \"ident\": \"-\",\n                    \"auth\": \"-\",\n                    \"timestamp\": \"04/Jan/2015:05:16:22 +0000\",\n                    \"verb\": \"GET\",\n                    \"request\": \"/reset.css\",\n                    \"httpversion\": \"1.1\",\n                    \"response\": \"200\",\n                    \"bytes\": \"1015\",\n                    \"referrer\": \"\\\"http://www.semicomplete.com/projects/xdotool/\\\"\",\n                    \"agent\": \"\\\"Mozilla/5.0 (Windows NT 6.2; WOW64; rv:28.0) Gecko/20100101 Firefox/28.0\\\"\"\n                }\n            },\n            {\n                \"_index\": \"logstash-2016.06.08\",\n                \"_type\": \"logs\",\n                \"_id\": \"AVUvp19V9IHRPCebL71k\",\n                \"_score\": 0.17486966,\n                \"_source\": {\n                    \"message\": \"123.125.71.35 - - [04/Jan/2015:05:16:31 +0000] \\\"GET /blog/tags/release HTTP/1.1\\\" 200 40693 \\\"-\\\" \\\"Mozilla/5.0 (compatible; Baiduspider/2.0; +http://www.baidu.com/search/spider.html)\\\"\",\n                    \"@version\": \"1\",\n                    \"@timestamp\": \"2016-06-08T10:55:41.740Z\",\n                    \"path\": \"/home/anbc/test/logstash-tutorial_1.log\",\n                    \"host\": \"localhost.localdomain\",\n                    \"clientip\": \"123.125.71.35\",\n                    \"ident\": \"-\",\n                    \"auth\": \"-\",\n                    \"timestamp\": \"04/Jan/2015:05:16:31 +0000\",\n                    \"verb\": \"GET\",\n                    \"request\": \"/blog/tags/release\",\n                    \"httpversion\": \"1.1\",\n                    \"response\": \"200\",\n                    \"bytes\": \"40693\",\n                    \"referrer\": \"\\\"-\\\"\",\n                    \"agent\": \"\\\"Mozilla/5.0 (compatible; Baiduspider/2.0; +http://www.baidu.com/search/spider.html)\\\"\"\n                }\n            }\n        ]\n    }\n}\n</code></pre><h2 id=\"2、kibana配置\" class=\"calibre13\">2、kibana配置</h2>\n<h3 id=\"21、web访问kibana\" class=\"calibre9\">2.1、web访问kibana</h3>\n<p class=\"calibre12\"><a href=\"http://10.136.122.67:5601/\" target=\"_blank\" class=\"pcalibre pcalibre2 pcalibre1 calibre20\">http:\\/\\/10.136.122.67:5601\\/</a></p>\n\n        </div>\n    \n</div>\n\n        \n    \n\n\n\n",
  "slug": 6588885,
  "title": "di_yi_jie_bu_shu"
}